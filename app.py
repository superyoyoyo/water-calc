import streamlit as st

# 1. é é¢åŸºæœ¬è¨­å®š
st.set_page_config(page_title="æ°´è™•ç†è¨ˆç®—æ©Ÿ", page_icon="ğŸ’§")
st.title("ğŸ’§æ°´è™•ç†å·¥ç¨‹è¨ˆç®—")

# 2. å»ºç«‹å´é‚Šæ¬„æˆ–ä¸»ç•«é¢çš„é¸å–®
# é€™è£¡æˆ‘å€‘åšä¸€å€‹ä¸‹æ‹‰é¸å–®ï¼Œè®“ä½¿ç”¨è€…é¸æ“‡è¦ç®—ä»€éº¼
calculation_type = st.selectbox(
    "è«‹é¸æ“‡è¨ˆç®—é …ç›®ï¼š",
    ["è»ŸåŒ–ç³»çµ± (Softener)", "æ»¿åºŠç³»çµ± (2BT)", "æ··åºŠç³»çµ± (MB)" ,"FRPæ¡¶æ¿¾æè¨ˆç®—"]
)

st.markdown("---") # ç•«ä¸€æ¢åˆ†éš”ç·š

# ==========================================
# æ¨¡å¼ A: è»ŸåŒ–ç³»çµ± (é€™æ˜¯åŸæœ¬çš„åŠŸèƒ½)
# ==========================================
if calculation_type == "è»ŸåŒ–ç³»çµ± (Softener)":
    st.header("ğŸ§‚ è»ŸåŒ–ç³»çµ±è¨ˆç®—")
    
    # [è¼¸å…¥å€]
    col1, col2 = st.columns(2)
    with col1:
        x = st.number_input("æ¨¹è„‚äº¤æ›å®¹é‡ (g/L)", value=40.0)
    with col2:
        y = st.number_input("æ¨¹è„‚ç¸½é‡ (L)", value=150.0)
    z = st.number_input("åŸæ°´ç¸½ç¡¬åº¦ (ppm CaCO3)", value=100.0)

    # [è¨ˆç®—èˆ‡çµæœ]
    if st.button("è¨ˆç®—è»ŸåŒ–ç”¢èƒ½"):
        if z <= 0:
            st.error("ç¡¬åº¦å¿…é ˆå¤§æ–¼ 0")
        else:
            ans = (x * y) / z
            safe_ans = ans * 0.7
            st.success(f"å»ºè­°æ¡æ°´é‡ï¼š**{safe_ans:.2f}** å™¸")

# ==========================================
# ==========================================
# ==========================================
# æ¨¡å¼ G: æ»¿åºŠç³»çµ± (2BT) - å°é›»åº¦è¨ˆç®—ç‰ˆ (æ›´æ–°æ•¸æ“š)
# ==========================================
elif calculation_type == "æ»¿åºŠç³»çµ± (2BT)":
    st.header("ğŸ“¦ æ»¿åºŠç³»çµ± (2BT) é€ æ°´é‡è¨ˆç®—")
    st.info("è¨ˆç®—åŸºç¤ï¼šåŸæ°´å°é›»åº¦ / 1.5 = TDSï¼Œä»¥é™°é›¢å­äº¤æ›é‡ç‚ºåŸºæº–")

    # --- 1. å®šç¾©å‹è™Ÿèˆ‡é™°é›¢å­æ¨¹è„‚é‡çš„å°ç…§è¡¨ ---
    # æ ¹æ“šæ‚¨æä¾›çš„æ•¸æ“šæ›´æ–°
    bt_data = {
        "3000å‹": 150.0,
        "5000å‹": 400.0,
        "7000å‹": 600.0,
        "9000å‹": 800.0
    }

    # --- 2. å»ºç«‹è¼¸å…¥ä»‹é¢ ---
    col1, col2 = st.columns(2)
    
    with col1:
        # ä¸‹æ‹‰é¸å–®é¸æ“‡å‹è™Ÿ
        selected_model = st.selectbox("è«‹é¸æ“‡ 2BT å‹è™Ÿ", list(bt_data.keys()))
        # è‡ªå‹•æŠ“å–å°æ‡‰çš„æ¨¹è„‚é‡
        anion_vol = bt_data[selected_model]
        st.write(f"ğŸ“ **{selected_model}** é™°é›¢å­æ¨¹è„‚é‡ï¼š `{anion_vol} å…¬å‡`")

    with col2:
        # è¼¸å…¥å°é›»åº¦
        conductivity = st.number_input("åŸæ°´å°é›»åº¦ (Î¼S/cm)", value=200.0, step=10.0)

    # è¨­å®šåƒæ•¸ï¼š1å…¬å‡é™°é›¢å­å¯å¸é™„ 25å…‹ (æ‚¨å¯åœ¨æ­¤å¾®èª¿ï¼Œæˆ–éš±è—ä¸è®“ä¿®æ”¹)
    k_val = st.number_input("é™°æ¨¹è„‚å¸é™„èƒ½åŠ› (å…‹/å…¬å‡)", value=25.0, disabled=True) 
    # disabled=True ä»£è¡¨é–å®šä¸è®“ä½¿ç”¨è€…æ”¹ï¼Œè‹¥æƒ³é–‹æ”¾ä¿®æ”¹è«‹æ‹¿æ‰é€™å€‹åƒæ•¸

    st.markdown("---")

    # --- 3. è¨ˆç®—é‚è¼¯ ---
    if st.button("è¨ˆç®—é€±æœŸé€ æ°´é‡"):
        if conductivity <= 0:
            st.error("âŒ å°é›»åº¦å¿…é ˆå¤§æ–¼ 0")
        else:
            # æ­¥é©Ÿ A: ç®—å‡ºç¤¦ç‰©è³ªé‡ (TDS)
            tds_content = conductivity / 1.5
            
            # æ­¥é©Ÿ B: ç®—å‡ºç¸½å¸é™„èƒ½åŠ› (æ¨¹è„‚å…¬å‡æ•¸ * 25å…‹)
            total_capacity = anion_vol * k_val
            
            # æ­¥é©Ÿ C: ç®—å‡ºå™¸æ•¸ (ç¸½èƒ½åŠ› / TDS)
            # å…¬å¼æ¨å°ï¼š (L * g/L) / (g/å™¸) = å™¸
            water_tons = total_capacity / tds_content
            
            # --- 4. é¡¯ç¤ºçµæœ ---
            st.subheader(f"ğŸ“Š è¨ˆç®—çµæœ - {selected_model}")
            
            # ä½¿ç”¨ä¸‰æ¬„é¡¯ç¤ºé—œéµæ•¸æ“š
            c1, c2, c3 = st.columns(3)
            c1.metric("åŸæ°´ TDS (ä¼°ç®—)", f"{tds_content:.1f} ppm")
            c2.metric("ç¸½å¸é™„èƒ½åŠ›", f"{total_capacity:,.0f} å…‹")
            c3.metric("é ä¼°é€±æœŸé€ æ°´é‡", f"{water_tons:.1f} å™¸")
            
            # é¡¯ç¤ºè©³ç´°è¨ˆç®—å¼ (è®“ä½¿ç”¨è€…å®‰å¿ƒ)
            st.caption(
                f"ğŸ’¡ è¨ˆç®—å…¬å¼ï¼š({anion_vol}å…¬å‡ Ã— {k_val}å…‹) Ã· ({conductivity} Ã· 1.5) = {water_tons:.1f} å™¸"
            )
# æ¨¡å¼ C: é™°é›¢å­ç³»çµ± (é ç•™çµ¦æ‚¨å¡«å¯«)
# ==========================================
elif calculation_type == "é™°é›¢å­ç³»çµ± (Anion)":
    st.header("ğŸ§ª é™°é›¢å­äº¤æ›è¨ˆç®—")
    st.write("ğŸš§ åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œè«‹ä¾ç…§ä¸Šæ–¹æ ¼å¼è‡ªè¡Œè¤‡è£½ä¿®æ”¹ç¨‹å¼ç¢¼...")

# ==========================================
# æ¨¡å¼ D: æ··åºŠ (é ç•™çµ¦æ‚¨å¡«å¯«)
# ==========================================
elif calculation_type == "æ··åºŠç³»çµ± (MB)":
    st.header("ğŸ”„ æ··åºŠç³»çµ±è¨ˆç®—")
    st.write("ğŸš§ åŠŸèƒ½é–‹ç™¼ä¸­...")
# ==========================================
# æ¨¡å¼ E: FRP æ¡¶å‹è™Ÿè¨ˆç®— (æ–°å¢åŠŸèƒ½)
# ==========================================
elif calculation_type == "FRPæ¡¶æ¿¾æè¨ˆç®—":
    st.header("ğŸ›¢ï¸ FRP æ¡¶æ¿¾æé‡è¨ˆç®—")
    st.info("è¼¸å…¥å‹è™Ÿ (å¦‚ 1054)ï¼Œè‡ªå‹•ä¼°ç®—æ¿¾æå…¬å‡æ•¸")

    # [è¼¸å…¥å€]
    col1, col2 = st.columns([2, 1])
    with col1:
        model_code = st.text_input("è«‹è¼¸å…¥ FRP æ¡¶å‹è™Ÿ", value="1054", placeholder="ä¾‹å¦‚ï¼š1054, 1354")
    with col2:
        # è®“æ‚¨å¯ä»¥å¾®èª¿å¡«å……ç‡ (é è¨­ 70%)
        fill_percent = st.number_input("å¡«å……æ¯”ä¾‹ (%)", value=70, step=5)

    # [è¨ˆç®—é‚è¼¯]
    if st.button("è¨ˆç®—å¡«å……é‡"):
        # 1. æª¢æŸ¥è¼¸å…¥æ ¼å¼æ˜¯å¦ç‚ºæ•¸å­—
        if not model_code.isdigit() or len(model_code) < 3:
            st.error("âŒ æ ¼å¼éŒ¯èª¤ï¼è«‹è¼¸å…¥è‡³å°‘ 3 ç¢¼æ•¸å­— (ä¾‹å¦‚ 844 æˆ– 1054)")
        else:
            try:
                # 2. æ‹†è§£å‹è™Ÿ (æœ€å¾Œå…©ç¢¼æ˜¯é«˜åº¦ï¼Œå‰é¢æ˜¯ç›´å¾‘)
                h_inch = int(model_code[-2:])   # å–æœ€å¾Œå…©å€‹å­—
                d_inch = int(model_code[:-2])   # å–å‰é¢å‰©ä¸‹çš„å­—
                
                # 3. è¨ˆç®—é«”ç© (åœ“æŸ±å…¬å¼)
                import math
                radius_inch = d_inch / 2
                area_sq_inch = math.pi * (radius_inch ** 2)
                volume_cu_inch = area_sq_inch * h_inch
                
                # 4. å–®ä½æ›ç®— (1 ç«‹æ–¹è‹±å‹ = 0.016387 å…¬å‡)
                total_liters = volume_cu_inch * 0.016387
                
                # 5. è¨ˆç®—å»ºè­°å¡«å……é‡
                fill_liters = total_liters * (fill_percent / 100)
                
                # 6. è¨ˆç®—åŒ…æ•¸ (å‡è¨­ä¸€åŒ… 25L)
                bags = fill_liters / 25
                
                # [é¡¯ç¤ºçµæœ]
                st.markdown("---")
                st.subheader(f"ğŸ“Š å‹è™Ÿ {model_code} è¨ˆç®—çµæœ")
                
                c1, c2, c3 = st.columns(3)
                c1.metric("ç›´å¾‘ x é«˜åº¦", f"{d_inch}\" x {h_inch}\"")
                c2.metric("å…¨æ¡¶ç¸½å®¹ç©", f"{total_liters:.1f} L")
                c3.metric(f"å»ºè­°å¡«å……é‡ ({fill_percent}%)", f"{fill_liters:.1f} L", delta=f"ç´„ {bags:.1f} åŒ…")
                
                # é¡å¤–è³‡è¨Šï¼šé¡¯ç¤ºå¸¸ç”¨çš„ 65%~75% ç¯„åœ
                st.caption(f"ğŸ’¡ åƒè€ƒï¼š{total_liters*0.65:.1f}L (65%) ~ {total_liters*0.75:.1f}L (75%)")

            except Exception as e:
                st.error(f"è¨ˆç®—ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
















