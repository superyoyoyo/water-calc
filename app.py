import streamlit as st

# 1. é é¢åŸºæœ¬è¨­å®š
st.set_page_config(page_title="æ°´è™•ç†è¨ˆç®—æ©Ÿ", page_icon="ğŸ’§")
st.title("ğŸ’§æ°´è™•ç†å·¥ç¨‹è¨ˆç®—")

# 2. å»ºç«‹å´é‚Šæ¬„æˆ–ä¸»ç•«é¢çš„é¸å–®
# é€™è£¡æˆ‘å€‘åšä¸€å€‹ä¸‹æ‹‰é¸å–®ï¼Œè®“ä½¿ç”¨è€…é¸æ“‡è¦ç®—ä»€éº¼
calculation_type = st.selectbox(
    "è«‹é¸æ“‡è¨ˆç®—é …ç›®ï¼š",
    ["è»ŸåŒ–ç³»çµ± (Softener)", "æ»¿åºŠç³»çµ± (2BT)", "æ··åºŠç³»çµ± (MB)" ,"FRPæ¡¶æ¿¾æè¨ˆç®—"]
)

st.markdown("---") # ç•«ä¸€æ¢åˆ†éš”ç·š

# ==========================================
# æ¨¡å¼ A: è»ŸåŒ–ç³»çµ± (é€™æ˜¯åŸæœ¬çš„åŠŸèƒ½)
# ==========================================
if calculation_type == "è»ŸåŒ–ç³»çµ± (Softener)":
    st.header("ğŸ§‚ è»ŸåŒ–ç³»çµ±è¨ˆç®—")
    
    # [è¼¸å…¥å€]
    col1, col2 = st.columns(2)
    with col1:
        x = st.number_input("æ¨¹è„‚äº¤æ›å®¹é‡ (g/L)", value=40.0)
    with col2:
        y = st.number_input("æ¨¹è„‚ç¸½é‡ (L)", value=150.0)
    z = st.number_input("åŸæ°´ç¸½ç¡¬åº¦ (ppm CaCO3)", value=100.0)

    # [è¨ˆç®—èˆ‡çµæœ]
    if st.button("è¨ˆç®—è»ŸåŒ–ç”¢èƒ½"):
        if z <= 0:
            st.error("ç¡¬åº¦å¿…é ˆå¤§æ–¼ 0")
        else:
            ans = (x * y) / z
            safe_ans = ans * 0.7
            st.success(f"å»ºè­°æ¡æ°´é‡ï¼š**{safe_ans:.2f}** å™¸")

# ==========================================
# æ¨¡å¼ B: æ»¿åºŠç³»çµ± (é€™æ˜¯æ–°å¢çš„ç¤ºç¯„)
# ==========================================
# ==========================================
# æ¨¡å¼ G: æ»¿åºŠç³»çµ± (2BT) - å‹è™Ÿé¸å–®ç‰ˆ
# ==========================================
elif calculation_type == "æ»¿åºŠç³»çµ± (2BT)":
    st.header("ğŸ“¦ æ»¿åºŠç³»çµ± (2BT) é¸å‹è¨ˆç®—")
    st.info("è«‹é¸æ“‡è¨­å‚™å‹è™Ÿï¼Œç³»çµ±å°‡è¨ˆç®—å°æ‡‰é€ æ°´é‡")

    # 1. å»ºç«‹å‹è™Ÿæ¸…å–® (ä¸‹æ‹‰é¸å–®)
    # æ‚¨å¯ä»¥åœ¨é€™è£¡éš¨æ™‚å¢åŠ æ–°çš„å‹è™Ÿ
    model_options = ["3000å‹", "5000å‹", "7000å‹", "9000å‹"]
    
    selected_2bt = st.selectbox("è«‹é¸æ“‡ 2BT å‹è™Ÿï¼š", model_options)

    # 2. é ç•™å…¬å¼è¨ˆç®—å€ (é€™è£¡æˆ‘å€‘å…ˆç”¨å‡çš„æ•¸æ“šä½”ä½)
    # ç­‰ä¹‹å¾Œè¨è«–å¥½å…¬å¼ï¼Œæˆ‘å€‘åªè¦ä¿®æ”¹é€™è£¡çš„ if/elif é‚è¼¯å³å¯
    
    output_water = 0.0 # é è¨­é€ æ°´é‡
    
    if selected_2bt == "3000å‹":
        output_water = 0 # å¾…å¡«å…¥ 3000å‹çš„å…¬å¼æˆ–æ•¸å€¼
    elif selected_2bt == "5000å‹":
        output_water = 0 # å¾…å¡«å…¥ 5000å‹çš„å…¬å¼æˆ–æ•¸å€¼
    elif selected_2bt == "7000å‹":
        output_water = 0 # å¾…å¡«å…¥ 7000å‹çš„å…¬å¼æˆ–æ•¸å€¼
    elif selected_2bt == "9000å‹":
        output_water = 0 # å¾…å¡«å…¥ 9000å‹çš„å…¬å¼æˆ–æ•¸å€¼

    st.markdown("---")

    # 3. é¡¯ç¤ºçµæœå€
    st.subheader(f"ğŸ“Š è¨ˆç®—çµæœ - {selected_2bt}")
    
    # ä½¿ç”¨ Metric é¡¯ç¤ºå¤§å­—é«”ï¼Œçœ‹èµ·ä¾†æ¯”è¼ƒå°ˆæ¥­
    # "å¾…å®šå…¬å¼" çš„å­—æ¨£ç­‰å…¬å¼ç¢ºå®šå¾Œå¯ä»¥æ‹¿æ‰
    st.metric("é ä¼°é€±æœŸé€ æ°´é‡", f"{output_water} å™¸", delta="å…¬å¼å¾…å®šç¾©")
    
    # é€™è£¡å¯ä»¥åŠ ä¸€å€‹èªªæ˜ï¼Œæé†’ä½¿ç”¨è€…ç›®å‰çš„ç‹€æ…‹
    st.caption("âš ï¸ æ³¨æ„ï¼šç›®å‰çš„é€ æ°´é‡æ•¸å€¼å°šæœªè¨­å®šå…¬å¼ã€‚")
# æ¨¡å¼ C: é™°é›¢å­ç³»çµ± (é ç•™çµ¦æ‚¨å¡«å¯«)
# ==========================================
elif calculation_type == "é™°é›¢å­ç³»çµ± (Anion)":
    st.header("ğŸ§ª é™°é›¢å­äº¤æ›è¨ˆç®—")
    st.write("ğŸš§ åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œè«‹ä¾ç…§ä¸Šæ–¹æ ¼å¼è‡ªè¡Œè¤‡è£½ä¿®æ”¹ç¨‹å¼ç¢¼...")

# ==========================================
# æ¨¡å¼ D: æ··åºŠ (é ç•™çµ¦æ‚¨å¡«å¯«)
# ==========================================
elif calculation_type == "æ··åºŠç³»çµ± (MB)":
    st.header("ğŸ”„ æ··åºŠç³»çµ±è¨ˆç®—")
    st.write("ğŸš§ åŠŸèƒ½é–‹ç™¼ä¸­...")
# ==========================================
# æ¨¡å¼ E: FRP æ¡¶å‹è™Ÿè¨ˆç®— (æ–°å¢åŠŸèƒ½)
# ==========================================
elif calculation_type == "FRPæ¡¶æ¿¾æè¨ˆç®—":
    st.header("ğŸ›¢ï¸ FRP æ¡¶æ¿¾æé‡è¨ˆç®—")
    st.info("è¼¸å…¥å‹è™Ÿ (å¦‚ 1054)ï¼Œè‡ªå‹•ä¼°ç®—æ¿¾æå…¬å‡æ•¸")

    # [è¼¸å…¥å€]
    col1, col2 = st.columns([2, 1])
    with col1:
        model_code = st.text_input("è«‹è¼¸å…¥ FRP æ¡¶å‹è™Ÿ", value="1054", placeholder="ä¾‹å¦‚ï¼š1054, 1354")
    with col2:
        # è®“æ‚¨å¯ä»¥å¾®èª¿å¡«å……ç‡ (é è¨­ 70%)
        fill_percent = st.number_input("å¡«å……æ¯”ä¾‹ (%)", value=70, step=5)

    # [è¨ˆç®—é‚è¼¯]
    if st.button("è¨ˆç®—å¡«å……é‡"):
        # 1. æª¢æŸ¥è¼¸å…¥æ ¼å¼æ˜¯å¦ç‚ºæ•¸å­—
        if not model_code.isdigit() or len(model_code) < 3:
            st.error("âŒ æ ¼å¼éŒ¯èª¤ï¼è«‹è¼¸å…¥è‡³å°‘ 3 ç¢¼æ•¸å­— (ä¾‹å¦‚ 844 æˆ– 1054)")
        else:
            try:
                # 2. æ‹†è§£å‹è™Ÿ (æœ€å¾Œå…©ç¢¼æ˜¯é«˜åº¦ï¼Œå‰é¢æ˜¯ç›´å¾‘)
                h_inch = int(model_code[-2:])   # å–æœ€å¾Œå…©å€‹å­—
                d_inch = int(model_code[:-2])   # å–å‰é¢å‰©ä¸‹çš„å­—
                
                # 3. è¨ˆç®—é«”ç© (åœ“æŸ±å…¬å¼)
                import math
                radius_inch = d_inch / 2
                area_sq_inch = math.pi * (radius_inch ** 2)
                volume_cu_inch = area_sq_inch * h_inch
                
                # 4. å–®ä½æ›ç®— (1 ç«‹æ–¹è‹±å‹ = 0.016387 å…¬å‡)
                total_liters = volume_cu_inch * 0.016387
                
                # 5. è¨ˆç®—å»ºè­°å¡«å……é‡
                fill_liters = total_liters * (fill_percent / 100)
                
                # 6. è¨ˆç®—åŒ…æ•¸ (å‡è¨­ä¸€åŒ… 25L)
                bags = fill_liters / 25
                
                # [é¡¯ç¤ºçµæœ]
                st.markdown("---")
                st.subheader(f"ğŸ“Š å‹è™Ÿ {model_code} è¨ˆç®—çµæœ")
                
                c1, c2, c3 = st.columns(3)
                c1.metric("ç›´å¾‘ x é«˜åº¦", f"{d_inch}\" x {h_inch}\"")
                c2.metric("å…¨æ¡¶ç¸½å®¹ç©", f"{total_liters:.1f} L")
                c3.metric(f"å»ºè­°å¡«å……é‡ ({fill_percent}%)", f"{fill_liters:.1f} L", delta=f"ç´„ {bags:.1f} åŒ…")
                
                # é¡å¤–è³‡è¨Šï¼šé¡¯ç¤ºå¸¸ç”¨çš„ 65%~75% ç¯„åœ
                st.caption(f"ğŸ’¡ åƒè€ƒï¼š{total_liters*0.65:.1f}L (65%) ~ {total_liters*0.75:.1f}L (75%)")

            except Exception as e:
                st.error(f"è¨ˆç®—ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")














